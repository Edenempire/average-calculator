<!doctype html>
<html lang="en" data-theme="dark" data-stealth="false">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Average Calculator — Stealth Player</title>

<style>
/* ===================== VARIABLES ===================== */
:root{
  --bg:#0b0d10;--fg:#f2f2f2;--muted:#9aa0aa;
  --soft:#161a22;--accent:#4c8dff;
  --bw:2px;--br:12px;
  --mono:"JetBrains Mono",monospace;
}
[data-theme="light"]{--bg:#fff;--fg:#000;--soft:#f3f3f3;--accent:#0a5cff}
[data-theme="oled"]{--bg:#000;--fg:#eaeaea;--soft:#050505;--accent:#00ff9c}
[data-theme="terminal"]{--bg:#001400;--fg:#00ff66;--soft:#002200;--accent:#00ff66}
[data-theme="midnight"]{--bg:#050914;--fg:#dce3ff;--soft:#0a1022;--accent:#6b8cff}

/* ===================== BASE ===================== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:var(--mono);
}
button,input,textarea{
  background:var(--bg);
  color:var(--fg);
  border:var(--bw) solid var(--fg);
  border-radius:8px;
  padding:8px 12px;
  font-family:inherit;
}
button:hover{background:var(--soft)}
.hidden{display:none}
.small{font-size:.75rem;color:var(--muted)}

/* ===================== LAYOUT ===================== */
.app{
  max-width:1600px;
  margin:auto;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:24px;
}
header,section,aside{
  border:var(--bw) solid var(--fg);
  border-radius:var(--br);
  padding:20px;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:16px;
}
main{
  display:grid;
  grid-template-columns:1fr 420px;
  gap:24px;
}
[data-stealth="true"] aside{display:none}

/* ===================== MOBILE ===================== */
@media(max-width:900px){
  main{grid-template-columns:1fr}
  aside{order:-1}
}

/* ===================== PLAYER ===================== */
aside{
  display:flex;
  flex-direction:column;
  gap:18px;
}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.progress{
  height:14px;
  border:1px solid var(--fg);
  border-radius:8px;
  cursor:pointer;
  overflow:hidden;
}
.fill{
  height:100%;
  width:0;
  background:var(--accent);
}
#tracks{
  border:1px solid var(--fg);
  border-radius:8px;
  max-height:260px;
  overflow-y:auto;
  padding:8px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.track{
  padding:8px 10px;
  border-radius:6px;
  cursor:pointer;
}
.track:hover{background:var(--soft)}
.track[aria-current="true"]{
  background:var(--accent);
  color:#fff;
}
kbd{
  border:1px solid var(--fg);
  border-radius:4px;
  padding:2px 6px;
  font-size:.7rem;
}
</style>
</head>

<body>
<div class="app">

<header>
  <div>
    <h1>AVERAGE CALCULATOR</h1>
    <div class="small">Tier-3 Utility</div>
  </div>
  <div class="controls">
    <button id="themeBtn">Theme</button>
    <button id="stealthBtn">Stealth</button>
    <button id="panicBtn">Silence</button>
  </div>
</header>

<main>

<section>
<textarea id="input" rows="6" placeholder="Enter numeric dataset"></textarea>
<br><br>
<button id="calc">Calculate</button>
<div id="stats" class="small"></div>
</section>

<aside>
<h3 class="small">Audio Engine</h3>

<div class="controls">
  <button id="playBtn">▶</button>
  <button id="stop">■</button>
  <button id="prev">⏮</button>
  <button id="next">⏭</button>
  <button id="mute">Mute</button>
  <button id="repeat">Repeat Off</button>
  <button id="lock">Lock</button>
</div>

<div class="controls">
  <button id="seekB">−5s</button>
  <button id="seekF">+5s</button>
</div>

<div class="progress" id="progress">
  <div class="fill" id="fill"></div>
</div>

<label class="small">Volume</label>
<input id="vol" type="range" min="0" max="1" step="0.01">

<div id="now" class="small"></div>
<div id="tracks"></div>

<div class="small">
<b>Keyboard</b><br>
<kbd>Space</kbd> Play/Pause • <kbd>Enter</kbd> Stop •
<kbd>← →</kbd> Seek • <kbd>↑ ↓</kbd> Volume •
<kbd>N/P</kbd> Track • <kbd>M</kbd> Mute •
<kbd>H</kbd> Stealth • <kbd>X</kbd> Panic
</div>
</aside>

</main>

<footer class="small">—</footer>

<audio id="audio" preload="metadata"></audio>

<script>
(()=>{
"use strict";

/* MEDIA SESSION OFF */
if("mediaSession" in navigator){
  try{
    navigator.mediaSession.metadata=null;
    ["play","pause","previoustrack","nexttrack","seekforward","seekbackward"]
      .forEach(a=>navigator.mediaSession.setActionHandler(a,null));
  }catch(e){}
}

const $=id=>document.getElementById(id);
const clamp=(v,min,max)=>Math.min(max,Math.max(min,v));

/* STATE */
const state={idx:0,locked:false,repeat:0};

/* THEMES */
const themes=["dark","light","oled","terminal","midnight"];
let theme=0;
themeBtn.onclick=()=>{
  theme=(theme+1)%themes.length;
  document.documentElement.dataset.theme=themes[theme];
};

/* STEALTH */
stealthBtn.onclick=()=>{
  document.documentElement.dataset.stealth =
    document.documentElement.dataset.stealth==="true"?"false":"true";
};
panicBtn.onclick=()=>{
  audio.pause();
  audio.currentTime=0;
  audio.volume=0;
};

/* AUDIO */
const audio=$("audio");
const trackBox=$("tracks");
const now=$("now");

const tracks=[...Array(40)].map((_,i)=>`${String(i+1).padStart(2,"0")}.mp3`);

tracks.forEach((t,i)=>{
  const d=document.createElement("div");
  d.className="track";
  d.textContent=t;
  d.onclick=()=>!state.locked&&play(i);
  trackBox.appendChild(d);
});

function highlight(){
  [...trackBox.children].forEach((e,i)=>{
    e.setAttribute("aria-current",i===state.idx);
  });
}

function play(i=state.idx){
  state.idx=i;
  audio.src=tracks[i];
  audio.play().catch(()=>{});
  now.textContent=tracks[i];
  highlight();
}

/* CONTROLS */
playBtn.onclick=()=>audio.paused?play():audio.pause();
stop.onclick=()=>{audio.pause();audio.currentTime=0};
prev.onclick=()=>!state.locked&&play((state.idx-1+tracks.length)%tracks.length);
next.onclick=()=>!state.locked&&play((state.idx+1)%tracks.length);
mute.onclick=()=>audio.muted=!audio.muted;
lock.onclick=()=>state.locked=!state.locked;
seekB.onclick=()=>audio.currentTime=Math.max(0,audio.currentTime-5);
seekF.onclick=()=>audio.currentTime+=5;
vol.oninput=()=>audio.volume=vol.value;

/* PROGRESS */
audio.ontimeupdate=()=>{
  fill.style.width=((audio.currentTime/audio.duration)*100||0)+"%";
};
progress.onclick=e=>{
  const r=progress.getBoundingClientRect();
  audio.currentTime=((e.clientX-r.left)/r.width)*audio.duration;
};

/* REPEAT */
repeat.onclick=()=>{
  state.repeat=(state.repeat+1)%4;
  repeat.textContent=["Repeat Off","Repeat One","Repeat All","Shuffle"][state.repeat];
};
audio.onended=()=>{
  if(state.repeat===1) play(state.idx);
  else if(state.repeat===2) play((state.idx+1)%tracks.length);
  else if(state.repeat===3) play(Math.floor(Math.random()*tracks.length));
};

/* KEYBOARD */
document.onkeydown=e=>{
  if(e.target.tagName==="TEXTAREA")return;
  if(e.code==="Space"){e.preventDefault();playBtn.click();}
  if(e.key==="Enter")stop.click();
  if(e.key==="ArrowRight")audio.currentTime+=5;
  if(e.key==="ArrowLeft")audio.currentTime-=5;
  if(e.key==="ArrowUp")audio.volume=clamp(audio.volume+.05,0,1);
  if(e.key==="ArrowDown")audio.volume=clamp(audio.volume-.05,0,1);
  if(e.key==="n")next.click();
  if(e.key==="p")prev.click();
  if(e.key==="m")mute.click();
  if(e.key==="h")stealthBtn.click();
  if(e.key==="x")panicBtn.click();
};

/* STATS */
calc.onclick=()=>{
  const arr=input.value.split(/[^0-9eE+.-]+/).map(Number).filter(Number.isFinite);
  if(!arr.length)return;
  const n=arr.length;
  const mean=arr.reduce((a,b)=>a+b,0)/n;
  const rms=Math.sqrt(arr.reduce((a,b)=>a+b*b,0)/n);
  stats.innerHTML=`Count: ${n}<br>Mean: ${mean.toFixed(6)}<br>RMS: ${rms.toFixed(6)}`;
};

play(0);
})();
</script>

</div>
</body>
</html>
