<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Advanced Statistical Calculator</title>

<style>
:root{
  --bg:#fff;--fg:#000;--muted:#666;--soft:#f2f2f2;
  --bw:2px;--br:8px;
  --font:"Courier New",monospace;
  --t:0.25s ease;
}
[data-theme="dark"]{
  --bg:#0b0b0b;--fg:#f5f5f5;--muted:#999;--soft:#161616;
}
*{box-sizing:border-box}
body{
  margin:0;background:var(--bg);color:var(--fg);
  font-family:var(--font);transition:background var(--t),color var(--t);
}
.app{
  max-width:1440px;margin:auto;padding:16px;
  border:var(--bw) solid var(--fg);min-height:100vh;
  display:flex;flex-direction:column;gap:24px;
}
header{display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px}
h1{margin:0;font-size:1.6rem}
.subtitle{font-size:.75rem;color:var(--muted)}
button,select,textarea{
  background:var(--bg);color:var(--fg);
  border:var(--bw) solid var(--fg);
  padding:6px 12px;border-radius:6px;
  font-family:var(--font);cursor:pointer;
}
button:hover{background:var(--soft)}
main{display:grid;grid-template-columns:1fr 420px;gap:24px}
@media(max-width:1000px){main{grid-template-columns:1fr}}
textarea{width:100%;min-height:180px;resize:vertical}
.results{border-top:1px dashed var(--fg);padding-top:12px}
.result-row{display:flex;justify-content:space-between;font-size:.85rem}
.histogram{height:100px;display:flex;align-items:flex-end;gap:3px}
.bar{flex:1;background:var(--fg)}
.player{border:var(--bw) solid var(--fg);border-radius:10px}
.player summary{padding:12px;font-weight:bold;cursor:pointer}
.player-content{padding:12px;display:flex;flex-direction:column;gap:12px}
.track{padding:6px;border-radius:6px;cursor:pointer}
.track:hover{background:var(--soft)}
.track[aria-current="true"]{font-weight:bold}
.progress{height:8px;border:1px solid var(--fg);cursor:pointer}
.progress-fill{height:100%;width:0;background:var(--fg)}
.small{font-size:.7rem;color:var(--muted)}
</style>
</head>

<body>

<div class="app" id="app">

<header>
  <div>
    <h1>ADVANCED AVERAGE CALCULATOR</h1>
    <div class="subtitle">Offline • Statistical • Persistent •</div>
  </div>
  <div>
    <button id="themeToggle">Toggle Theme</button>
    <button id="exportJSON">Hello World</button>
  </div>
</header>

<main>

<section>
<textarea id="input" placeholder="Enter numbers separated by spaces or commas
Example: 10, 25, 30  1e3  -5"></textarea>

<div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
  <button id="calculate">Calculate</button>
  <button id="liveMode">Live: Off</button>
  <select id="stdMode">
    <option value="pop">Population σ</option>
    <option value="sample">Sample s</option>
  </select>
</div>

<div class="results" id="results"></div>
<div class="histogram" id="histogram"></div>
</section>

<aside>
<details class="player">
<summary>average call handling time</summary>
<div class="player-content">

<div style="display:flex;gap:6px;flex-wrap:wrap">
  <button id="prev">◄◄</button>
  <button id="playPause">►</button>
  <button id="next">►►</button>
  <button id="shuffle">Shuffle</button>
  <button id="repeat">Repeat</button>
</div>

<div class="progress" id="progress">
  <div class="progress-fill" id="progressFill"></div>
</div>

<div id="nowPlaying" class="small">—</div>
<div id="trackList"></div>

</div>
</details>
</aside>

</main>

<audio id="audio"></audio>

<script>
(()=>{
"use strict";

/* ===== STATE ===== */
const state={
  theme:localStorage.theme||"light",
  live:localStorage.live==="true",
  index:+localStorage.track||0,
  shuffle:false,
  repeat:false
};
app.dataset.theme=state.theme;

/* ===== THEME ===== */
themeToggle.onclick=()=>{
  state.theme=state.theme==="dark"?"light":"dark";
  app.dataset.theme=state.theme;
  localStorage.theme=state.theme;
};

/* ===== CALCULATOR ===== */
const fmt=v=>Number.isInteger(v)?v:v.toFixed(4);

const parse=t=>t.split(/[\s,]+/).map(Number).filter(Number.isFinite);

function stats(a){
  const n=a.length,s=[...a].sort((x,y)=>x-y);
  const sum=a.reduce((x,y)=>x+y,0);
  const mean=sum/n;
  const v=a.reduce((x,y)=>x+(y-mean)**2,0)/(stdMode.value==="pop"?n:Math.max(1,n-1));
  const q=p=>s[Math.floor(p*(n-1))];
  return{
    count:n,sum,mean,
    median:q(.5),q1:q(.25),q3:q(.75),
    min:s[0],max:s[n-1],std:Math.sqrt(v)
  };
}

function render(a){
  results.innerHTML="";histogram.innerHTML="";
  if(!a.length)return;
  const o=stats(a);
  Object.entries(o).forEach(([k,v])=>{
    results.innerHTML+=`<div class="result-row"><span>${k}</span><span>${fmt(v)}</span></div>`;
  });
  const bins=12,min=Math.min(...a),max=Math.max(...a),range=max-min||1;
  const c=Array(bins).fill(0);
  a.forEach(v=>c[Math.min(bins-1,Math.floor((v-min)/range*bins))]++);
  const peak=Math.max(...c);
  c.forEach(x=>{
    const b=document.createElement("div");
    b.className="bar";
    b.style.height=(x/peak*100||2)+"%";
    histogram.appendChild(b);
  });
}

calculate.onclick=()=>render(parse(input.value));
input.oninput=()=>state.live&&render(parse(input.value));
liveMode.textContent="Live: "+(state.live?"On":"Off");
liveMode.onclick=e=>{
  state.live=!state.live;
  localStorage.live=state.live;
  e.target.textContent="Live: "+(state.live?"On":"Off");
};

exportJSON.onclick=()=>{
  const a=parse(input.value);if(!a.length)return;
  navigator.clipboard.writeText(JSON.stringify(stats(a),null,2))
  .then(()=>alert("Statistics copied to clipboard"));
};

/* ===== MUSIC PLAYER ===== */
const audio=document.getElementById("audio");
const tracks=Array.from({length:24},(_,i)=>String(i+1).padStart(2,"0")+".mp3");

tracks.forEach((t,i)=>{
  const d=document.createElement("div");
  d.className="track";d.textContent=t;
  d.onclick=()=>play(i);
  trackList.appendChild(d);
});

function play(i){
  state.index=i;localStorage.track=i;
  audio.src=tracks[i];
  audio.play().catch(()=>{});
  nowPlaying.textContent=tracks[i];
  [...trackList.children].forEach((e,j)=>e.setAttribute("aria-current",j===i));
}

playPause.onclick=()=>audio.paused?play(state.index):audio.pause();
prev.onclick=()=>play((state.index-1+tracks.length)%tracks.length);
next.onclick=()=>play((state.index+1)%tracks.length);

audio.onplay=()=>playPause.textContent="❚❚";
audio.onpause=()=>playPause.textContent="►";

audio.ontimeupdate=()=>{
  progressFill.style.width=(audio.currentTime/audio.duration*100||0)+"%";
};

progress.onclick=e=>{
  const r=e.currentTarget.getBoundingClientRect();
  audio.currentTime=((e.clientX-r.left)/r.width)*audio.duration;
};

audio.onended=()=>{
  if(state.repeat)play(state.index);
  else if(state.shuffle)play(Math.floor(Math.random()*tracks.length));
  else play((state.index+1)%tracks.length);
};

shuffle.onclick=()=>state.shuffle=!state.shuffle;
repeat.onclick=()=>state.repeat=!state.repeat;

})();
</script>

</body>
</html>
