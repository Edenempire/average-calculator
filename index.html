<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Advanced Statistical Calculator</title>

<style>
/* =========================
   DESIGN SYSTEM
========================= */
:root{
  --bg:#ffffff;
  --fg:#000000;
  --muted:#666;
  --soft:#f3f3f3;
  --accent:#0a5cff;
  --danger:#d60000;
  --bw:2px;
  --br:10px;
  --t:.25s ease;
  --mono:"JetBrains Mono","Courier New",monospace;
}
[data-theme="dark"]{
  --bg:#0b0d10;
  --fg:#f2f2f2;
  --muted:#9aa0aa;
  --soft:#161a22;
  --accent:#4c8dff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:var(--mono);
  transition:background var(--t),color var(--t);
}

/* =========================
   LAYOUT
========================= */
.app{
  max-width:1600px;
  margin:auto;
  padding:16px;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  gap:24px;
}
header{
  display:flex;
  justify-content:space-between;
  gap:16px;
  flex-wrap:wrap;
  border:var(--bw) solid var(--fg);
  padding:12px;
  border-radius:var(--br);
}
h1{margin:0;font-size:1.6rem}
.subtitle{font-size:.75rem;color:var(--muted)}

main{
  display:grid;
  grid-template-columns:1fr 460px;
  gap:24px;
}
@media(max-width:1100px){main{grid-template-columns:1fr}}

section,aside{
  border:var(--bw) solid var(--fg);
  border-radius:var(--br);
  padding:16px;
}

/* =========================
   CONTROLS
========================= */
button,select,input[type="range"],textarea{
  background:var(--bg);
  color:var(--fg);
  border:var(--bw) solid var(--fg);
  border-radius:8px;
  padding:6px 12px;
  font-family:var(--mono);
  transition:background var(--t),transform var(--t);
}
button:hover{background:var(--soft)}
button:active{transform:scale(.97)}
button.active{background:var(--accent);color:#fff}
textarea{
  width:100%;
  min-height:180px;
  resize:vertical;
}
label{font-size:.75rem;color:var(--muted)}

/* =========================
   STATS
========================= */
.results{
  margin-top:12px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:8px;
}
.result{
  padding:6px 8px;
  border:1px dashed var(--fg);
  border-radius:6px;
  display:flex;
  justify-content:space-between;
  font-size:.8rem;
}

.histogram{
  margin-top:12px;
  height:120px;
  display:flex;
  align-items:flex-end;
  gap:4px;
}
.bar{
  flex:1;
  background:var(--accent);
  min-height:3px;
  border-radius:4px 4px 0 0;
}

.error{
  color:var(--danger);
  font-size:.75rem;
}

/* =========================
   PLAYER
========================= */
.player summary{
  cursor:pointer;
  font-weight:bold;
}
.player-controls{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.progress{
  height:10px;
  border:1px solid var(--fg);
  border-radius:6px;
  overflow:hidden;
  cursor:pointer;
}
.progress-fill{
  height:100%;
  width:0;
  background:var(--accent);
}
.volume{
  display:flex;
  align-items:center;
  gap:6px;
}
.track{
  padding:6px;
  border-radius:6px;
  cursor:pointer;
}
.track:hover{background:var(--soft)}
.track[aria-current="true"]{
  background:var(--accent);
  color:#fff;
}
.small{font-size:.7rem;color:var(--muted)}

/* =========================
   FOOTER UTIL
========================= */
footer{
  text-align:center;
  font-size:.7rem;
  color:var(--muted);
}
</style>
</head>

<body>
<div class="app" id="app">

<header>
  <div>
    <h1>ADVANCED STATISTICAL ENGINE</h1>
    <div class="subtitle">Offline • Persistent • Robust •</div>
  </div>
  <div style="display:flex;gap:8px;flex-wrap:wrap">
    <button id="themeToggle">Toggle Theme</button>
    <button id="clearInput">Clear</button>
    <button id="exportJSON">Hello World</button>
    <button id="exportCSV">Analytics</button>
  </div>
</header>

<main>

<section>
  <textarea id="input" placeholder="Enter numbers (spaces, commas, new lines, scientific notation allowed)
Example: 10, 25, 30 1e3 -5"></textarea>

  <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
    <button id="calculate">Calculate</button>
    <button id="liveMode">Live: Off</button>
    <select id="stdMode">
      <option value="pop">Population σ</option>
      <option value="sample">Sample s</option>
    </select>
    <select id="roundMode">
      <option value="2">Round: 2</option>
      <option value="4" selected>Round: 4</option>
      <option value="6">Round: 6</option>
    </select>
  </div>

  <div id="error" class="error"></div>
  <div class="results" id="results"></div>
  <div class="histogram" id="histogram"></div>
</section>

<aside>
<details class="player" open>
<summary>Average Handling Time</summary>

<div style="margin-top:12px;display:flex;flex-direction:column;gap:12px">

  <div class="player-controls">
    <button id="prev">⏮</button>
    <button id="playPause">▶</button>
    <button id="next">⏭</button>
    <button id="shuffle">Shuffle</button>
    <button id="repeat">Repeat</button>
  </div>

  <div class="progress" id="progress"><div class="progress-fill" id="progressFill"></div></div>

  <div class="volume">
    <label>Volume</label>
    <input id="volume" type="range" min="0" max="1" step="0.01">
    <span id="volLabel" class="small"></span>
  </div>

  <div id="nowPlaying" class="small">—</div>
  <div id="trackList"></div>

</div>
</details>
</aside>

</main>

<footer>
  Engineered for maximum robustness • Zero silent failures • Defensive programming
</footer>

<audio id="audio" preload="metadata"></audio>

<script>
(()=>{
"use strict";

/* =========================
   UTILITIES
========================= */
const $=id=>document.getElementById(id);
const safe=(fn)=>{try{fn()}catch(e){console.error(e);showError(e.message)}};
const showError=msg=>{error.textContent=msg||""};

/* =========================
   STATE
========================= */
const state={
  theme:localStorage.theme||"light",
  live:localStorage.live==="true",
  index:+localStorage.track||0,
  shuffle:false,
  repeat:false
};
app.dataset.theme=state.theme;

/* =========================
   THEME
========================= */
$('themeToggle').onclick=()=>{
  state.theme=state.theme==="dark"?"light":"dark";
  app.dataset.theme=state.theme;
  localStorage.theme=state.theme;
};

/* =========================
   STATISTICS ENGINE
========================= */
const parseInput=text=>{
  const arr=text.split(/[^0-9eE+\-.]+/).filter(Boolean).map(Number);
  if(!arr.length) throw new Error("No valid numeric values detected");
  if(arr.some(n=>!Number.isFinite(n))) throw new Error("Invalid number encountered");
  return arr;
};

const stats=arr=>{
  const n=arr.length;
  const s=[...arr].sort((a,b)=>a-b);
  const sum=arr.reduce((a,b)=>a+b,0);
  const mean=sum/n;
  const variance=arr.reduce((a,b)=>a+(b-mean)**2,0)/(stdMode.value==="pop"?n:Math.max(1,n-1));
  const q=p=>s[Math.floor(p*(n-1))];
  return{
    Count:n,
    Sum:sum,
    Mean:mean,
    Median:q(.5),
    Min:s[0],
    Max:s[n-1],
    Range:s[n-1]-s[0],
    Q1:q(.25),
    Q3:q(.75),
    IQR:q(.75)-q(.25),
    Variance:variance,
    StdDev:Math.sqrt(variance)
  };
};

const renderStats=arr=>{
  results.innerHTML=""; histogram.innerHTML="";
  const data=stats(arr);
  const r=+roundMode.value;
  Object.entries(data).forEach(([k,v])=>{
    const d=document.createElement('div');
    d.className='result';
    d.innerHTML=`<span>${k}</span><span>${Number.isInteger(v)?v:v.toFixed(r)}</span>`;
    results.appendChild(d);
  });
  // Histogram
  const bins=14,min=Math.min(...arr),max=Math.max(...arr),range=max-min||1;
  const counts=Array(bins).fill(0);
  arr.forEach(v=>counts[Math.min(bins-1,Math.floor((v-min)/range*bins))]++);
  const peak=Math.max(...counts);
  counts.forEach(c=>{
    const b=document.createElement('div');
    b.className='bar';
    b.style.height=((c/peak)*100||2)+'%';
    histogram.appendChild(b);
  });
};

calculate.onclick=()=>safe(()=>{showError('');renderStats(parseInput(input.value))});
input.oninput=()=>state.live&&safe(()=>{renderStats(parseInput(input.value))});

liveMode.textContent="Live: "+(state.live?"On":"Off");
liveMode.onclick=()=>{
  state.live=!state.live;
  localStorage.live=state.live;
  liveMode.textContent="Live: "+(state.live?"On":"Off");
};

clearInput.onclick=()=>{input.value='';results.innerHTML='';histogram.innerHTML='';showError('')};

exportJSON.onclick=()=>safe(()=>{
  const data=stats(parseInput(input.value));
  navigator.clipboard.writeText(JSON.stringify(data,null,2));
});
exportCSV.onclick=()=>safe(()=>{
  const data=stats(parseInput(input.value));
  const csv=Object.entries(data).map(([k,v])=>`${k},${v}`).join('\n');
  navigator.clipboard.writeText(csv);
});

/* =========================
   AUDIO PLAYER
========================= */
const audio=$('audio');
const tracks=Array.from({length:24},(_,i)=>`track-${String(i+1).padStart(2,'0')}.mp3`);

tracks.forEach((t,i)=>{
  const d=document.createElement('div');
  d.className='track';
  d.textContent=t;
  d.onclick=()=>play(i);
  trackList.appendChild(d);
});

function play(i){
  state.index=i;
  localStorage.track=i;
  audio.src=tracks[i];
  audio.play().catch(()=>{});
  nowPlaying.textContent=t;
  [...trackList.children].forEach((e,j)=>e.setAttribute('aria-current',j===i));
}

playPause.onclick=()=>audio.paused?play(state.index):audio.pause();
prev.onclick=()=>play((state.index-1+tracks.length)%tracks.length);
next.onclick=()=>play((state.index+1)%tracks.length);
shuffle.onclick=()=>shuffle.classList.toggle('active',state.shuffle=!state.shuffle);
repeat.onclick=()=>repeat.classList.toggle('active',state.repeat=!state.repeat);

volume.value=localStorage.volume||0.8;
audio.volume=volume.value;
volLabel.textContent=Math.round(volume.value*100)+'%';
volume.oninput=()=>{
  audio.volume=volume.value;
  localStorage.volume=volume.value;
  volLabel.textContent=Math.round(volume.value*100)+'%';
};

audio.ontimeupdate=()=>progressFill.style.width=((audio.currentTime/audio.duration)*100||0)+'%';
progress.onclick=e=>{
  const r=e.currentTarget.getBoundingClientRect();
  audio.currentTime=((e.clientX-r.left)/r.width)*audio.duration;
};

audio.onended=()=>{
  if(state.repeat) play(state.index);
  else if(state.shuffle) play(Math.floor(Math.random()*tracks.length));
  else play((state.index+1)%tracks.length);
};

})();
</script>
</div>
</body>
</html>
